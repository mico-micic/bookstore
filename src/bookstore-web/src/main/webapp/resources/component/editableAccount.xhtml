<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:b="http://books.org/bookstore"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://java.sun.com/jsf/composite">

    <body>
        <c:interface>
            <c:attribute name="value" required="true"/>
            <c:attribute name="country" type="org.books.presentation.CountriesBean" required="true"/>
            <c:attribute name="isNew" /> <!-- default := false -->
        </c:interface>
        <c:implementation>
            <h:outputStylesheet library="component" name="editableAccount/css/editableAccount.css" />
            <h4><h:outputText value="#{texts.yourDetails}:" /></h4>
            <h:form id="editAccount">
                <h:panelGrid columns="2" columnClasses="labelColumn," styleClass="accountEditTable">

                    <h:outputLabel for="firstName" value="#{texts.firstName}" />
                    <h:panelGroup>
                        <h:inputText id="firstName" value="#{cc.attrs.value.customer.firstName}" label="#{texts.firstName}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="firstName" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="lastName" value="#{texts.lastName}" />
                    <h:panelGroup>
                        <h:inputText id="lastName" value="#{cc.attrs.value.customer.lastName}" label="#{texts.lastName}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="lastName" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="street" value="#{texts.street}" />
                    <h:panelGroup>
                        <h:inputText id="street" value="#{cc.attrs.value.customer.address.street}" label="#{texts.street}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="street" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="postalCode" value="#{texts.postalCode}" />
                    <h:panelGroup>
                        <h:inputText id="postalCode" value="#{cc.attrs.value.customer.address.postalCode}" label="#{texts.postalCode}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="postalCode" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="city" value="#{texts.city}" />
                    <h:panelGroup>
                        <h:inputText id="city" value="#{cc.attrs.value.customer.address.city}" label="#{texts.city}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="city" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="country" value="#{texts.country}" />
                    <h:panelGroup>
                        <h:selectOneMenu id="country" label="#{texts.country}" required="true" value="#{cc.attrs.value.customer.address.country}" >
                            <f:selectItems value="#{cc.attrs.country.supportedCountries}" 
                                           var="country" 
                                           itemValue="#{country.code}" 
                                           itemLabel="#{country.name}" />
                        </h:selectOneMenu>
                        <div class="elementMessageDiv">
                            <h:message for="country" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="email" value="#{texts.email}" />
                    <h:panelGroup>
                        <h:inputText id="email" value="#{cc.attrs.value.customer.email}" label="#{texts.email}" required="true" />
                        <div class="elementMessageDiv">
                            <h:message for="email" styleClass="elementMessage" />
                        </div>
                    </h:panelGroup>
                </h:panelGrid>

                <h:panelGroup id="passwordGroup" rendered="#{cc.attrs.isNew == true}" styleClass="accountEditTable">
                    <h4><h:outputText value="#{texts.password}:" /></h4>
                    <h:panelGrid columns="2" columnClasses="labelColumn," >

                        <h:outputLabel for="password" value="#{texts.password}" />
                        <h:inputSecret id="password" value="#{cc.attrs.value.customer.password}" label="#{texts.password}" required="true" />

                        <h:outputLabel for="passwordConfirm" value="#{texts.confirmPassword}" />
                        <h:panelGroup>
                            <h:inputSecret id="passwordConfirm" value="#{cc.attrs.value.customer.password}" label="#{texts.confirmPassword}" required="true">
                                <b:validatePassword firstPassFieldId="password" />
                            </h:inputSecret>
                            <div class="elementMessageDiv">
                                <h:message for="passwordConfirm" styleClass="elementMessage" />
                            </div>
                        </h:panelGroup>
                    </h:panelGrid>
                </h:panelGroup>

                <h4><h:outputText value="#{texts.creditCard}:" /></h4>
                <h:panelGrid id="creditCard" columns="2" columnClasses="labelColumn," styleClass="accountEditTable">

                    <h:outputLabel for="creditCardType" value="#{texts.type}" />
                    <h:selectOneMenu id="creditCardType" value="#{cc.attrs.value.customer.creditCard.type}">
                        <f:selectItems value="#{cc.attrs.value.customer.creditCard.supportedTypes}" />
                    </h:selectOneMenu>

                    <h:outputLabel for="creditCardNumber" value="#{texts.number}" />
                    <h:panelGroup>
                        <h:inputText id="creditCardNumber" value="#{cc.attrs.value.customer.creditCard.number}" label="#{texts.number}" >
                            <f:converter converterId="org.books.presentation.converter.CreditCardNumberConverter" />
                            <f:validateLength minimum="16" maximum="16" />
                            <b:validateCreditCard cardTypeFieldId="creditCardType" />
                        </h:inputText>
                        <div class="elementMessageDiv">
                            <h:message for="creditCardNumber" styleClass="elementMessage" showSummary="true" showDetail="false" />
                        </div>
                    </h:panelGroup>

                    <h:outputLabel for="creditCardNumber" value="#{texts.dateOfExpiry}" />
                    <h:panelGroup>
                        <h:inputText id="expiryMonth" styleClass="expiryMonth" required="true" label="#{texts.month}" 
                                     value="#{cc.attrs.value.customer.creditCard.expirationMonth}">
                            <f:validateLongRange minimum="1" maximum="12" />
                        </h:inputText>
                        <div class="elementMessageDiv">
                            <h:message for="expiryMonth" styleClass="elementMessage" showSummary="true" showDetail="false" />
                        </div>
                        <h:outputText value="/" style="float:left;" />
                        <h:inputText id="expiryYear" styleClass="expiryYear" required="true" label="#{texts.year}" 
                                     value="#{cc.attrs.value.customer.creditCard.expirationYear}">
                            <f:validateLongRange minimum="#{cc.attrs.value.customer.creditCard.minExpirationYear}" 
                                                 maximum="#{cc.attrs.value.customer.creditCard.maxExpirationYear}" />
                        </h:inputText>
                        <div class="elementMessageDiv">
                            <h:message for="expiryYear" styleClass="elementMessage" showSummary="true" showDetail="false" />
                        </div>
                    </h:panelGroup>

                </h:panelGrid>
                <p/>
                <h:commandLink value="#{texts.save}" action="#{cc.attrs.value.updateCustomer}" rendered="#{cc.attrs.isNew == false}" />
                <h:commandLink value="#{texts.register}" action="#{cc.attrs.value.createCustomer}" rendered="#{cc.attrs.isNew == true}"  />
            </h:form>
        </c:implementation>
    </body>

</html>
